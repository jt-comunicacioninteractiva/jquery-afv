/**
 * jQuery - Ambar Forms Validator
 *
 * @author Javier Trejo @ JT - Comunicación Interactiva
 * @version 0.2.0
 * @see http://jt-comunicacioninteractiva.github.com/jquery-afv
 *
 * Este plugin se utiliza para validar formularios antes de ser enviados al
 * servidor.
 * Se inicia a si mismo por lo que no es necesario invocarlo y se vale de
 * los atributos data-afv-* y los atributos estandar de HTML para la
 * configuración.
 *
 */
(function(e){var t;var n={namespace:"afv",expresions:{email:/^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\.)+([A-Za-z0-9]{2,4}|museum)$/,url:/((http\:\/\/|https\:\/\/|ftp\:\/\/)|(www.))+(([a-zA-Z0-9\.-]+\.[a-zA-Z]{2,4})|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(\/[a-zA-Z0-9%:\/-_\?\.'~]*)?/,string:/^[a-zA-Z]+$/,number:/^\s*\d+\s*$/,extendedString:/^[-\sa-zA-Z0-9]+$/},errorMessages:{required:"El campo es obligatorio",minLength:"El campo debe tener {0} como mínimo",maxLength:"El campo debe tener {0} como máximo",defaultOption:"Debe seleccionar un valor",equalTo:"Los campos {0} y {1} deben ser iguales",format:"El valor ingresado no se corresponde con el formato requerido"},errorDisplay:"inside",errorClass:"afv-field-error"};var r={init:function(t){e.extend(n,t);e(document).ready(function(){e("[data-"+n.namespace+"-validate=true]").find("[data-"+n.namespace+"-role=submit]").bind("click",r.submit)})},validate:function(r){var i=true;t=[];e("."+n.errorClass).removeClass(n.errorClass).removeAttr("title");r.find("[data-"+n.namespace+"-required]").each(function(r,s){var s=e(s);switch(s.attr("type")){case"checkbox":if(!s.is(":checked")){i=false;t.push({field:s,message:n.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}break;default:if(s.val().length==0){i=false;t.push({field:s,message:n.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}}});r.find("[data-"+n.namespace+"-length-min]").each(function(r,s){var s=e(s);var o=e(s).attr("data-"+n.namespace+"-length-min");if(s.val().length<o){i=false;t.push({field:s,message:n.errorMessages.minLength,error:e.ambarFormsValidator.Validator.LENGTH_MIN})}});r.find("[data-"+n.namespace+"-length-max]").each(function(r,s){var s=e(s);var o=e(s).attr("data-"+n.namespace+"-length-max");if(s.val().length>o){i=false;t.push({field:s,message:n.errorMessages.maxLength,error:e.ambarFormsValidator.Validator.LENGTH_MAX})}});r.find("[data-"+n.namespace+"-equal-to]").each(function(r,s){var s=e(s);var o=e(s).attr("data-"+n.namespace+"-equal-to");o=e("#"+o);if(s.val()!=o.val()){i=false;t.push({field:s,message:n.errorMessages.equalTo,error:e.ambarFormsValidator.Validator.EQUAL_TO})}});r.find("[data-"+n.namespace+"-default]").each(function(r,s){var s=e(s);var o=s.attr("data-"+n.namespace+"-default");if(s.val()==o){i=false;t.push({field:s,message:n.errorMessages.defaultOption,error:e.ambarFormsValidator.Validator.SELECT_DEFAULT})}});r.find("[data-"+n.namespace+"-format]").each(function(r,s){var s=e(s);var o=s.attr("data-"+n.namespace+"-format");var u=n.expresions[o];if(!u.test(s.val())){i=false;t.push({field:s,message:n.errorMessages.format,error:e.ambarFormsValidator.Validator.FORMAT})}});return i},submit:function(t){t.preventDefault();var i=e(this).parent();if(r.validate(i)==true){if(i.attr("data-"+n.namespace+"-post-ajax")){var s=i.attr("action");var o=i.attr("method");var u=i.attr("data-"+n.namespace+"-ajax-success");var a=i.attr("data-"+n.namespace+"-ajax-failure");if(typeof u=="string")u=self[u];if(typeof a=="string")a=self[a];e.ajax({url:s,type:o,data:i.serialize(),cache:false,dataType:"json",success:u,error:a})}else{i.submit()}}else{switch(n.errorDisplay){case e.ambarFormsValidator.Display.INSIDE:r.display_inside();break;case e.ambarFormsValidator.Display.OUTSIDE:r.display_outside();break;case e.ambarFormsValidator.Display.FIELDS_BEFORE:r.display_before();break;case e.ambarFormsValidator.Display.FIELDS_AFTER:r.display_after();break}}},display_inside:function(){e(t).each(function(t,r){r.field.addClass(n.errorClass);var i=n.errorMessages[r.error];switch(r.field.attr("type")){case"checkbox":var s=r.field.attr("name");s=e('label[for="'+s+'"]');s.addClass(n.errorClass);s.attr("title",i);break}switch(r.error){case e.ambarFormsValidator.Validator.LENGTH_MIN:var o=r.field.attr("data-"+n.namespace+"-length-min");if(o==1)o=o+" caracter";else o=o+" caracteres";i=i.replace("{0}",o);break;case e.ambarFormsValidator.Validator.LENGTH_MAX:var o=r.field.attr("data-"+n.namespace+"-length-max");if(o==1)o=o+" caracter";else o=o+" caracteres";i=i.replace("{0}",o);break;case e.ambarFormsValidator.Validator.EQUAL_TO:var u=r.field.attr("data-"+n.namespace+"-equal-to");i=i.replace("{0}",e('label[for="'+u+'"]').html());i=i.replace("{1}",e('label[for="'+r.field.attr("name")+'"]').html());break}if(r.field.attr("title")==undefined)r.field.attr("title",i);else r.field.attr("title",r.field.attr("title")+"\n"+i)})},display_outside:function(){console.log("V0.2 - Muestra los mensajes de error fuera del campo a través de un elemento span")},fields_before:function(){console.log("V0.3 - Muestra los mensajes de error todos juntos al principio del formulario en un elemento div")},fields_after:function(){console.log("V0.3 - Muestra los mensajes de error todos juntos al final del formulario en un elemento div")}};e.fn.ambarFormsValidator=function(t){if(r[t]){return r[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return r.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.ambarFormsValidator")}};e.ambarFormsValidator={Validator:{REQUIRED:"required",LENGTH_MIN:"minLength",LENGTH_MAX:"maxLength",EQUAL_TO:"equalTo",SELECT_DEFAULT:"default",FORMAT:"format"},Display:{INSIDE:"inside",OUTSIDE:"outside",FIELDS_BEFORE:"before",FIELDS_AFTER:"after"},version:"0.1.0"}})(jQuery);$(document).ambarFormsValidator()