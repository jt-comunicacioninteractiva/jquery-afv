/**
 * jQuery - Ambar Forms Validator
 *
 * @author Javier Trejo @ JT - Comunicación Interactiva
 * @version 0.2.31
 * @see http://jt-comunicacioninteractiva.github.com/jquery-afv
 *
 * Este plugin se utiliza para validar formularios antes de ser enviados al
 * servidor.
 * Se inicia a si mismo por lo que no es necesario invocarlo y se vale de
 * los atributos data-afv-* y los atributos estandar de HTML para la
 * configuración.
 *
 */
(function(e){function i(t){var n=r.errorMessages[t.error];switch(t.error){case e.ambarFormsValidator.Validator.CHECKBOX_MIN:if(t.field.attr("data-"+r.namespace+"-check-error-message")!=undefined){n=t.field.attr("data-"+r.namespace+"-check-error-message")}else{var i=t.field.attr("data-"+r.namespace+"-check");if(i==1)i=i+" opción";else i=i+" opciones";n=n.replace("{0}",i)}break;case e.ambarFormsValidator.Validator.LENGTH_MIN:if(t.field.attr("data-"+r.namespace+"-length-min-error-message")!=undefined)n=t.field.attr("data-"+r.namespace+"-length-min-error-message");var i=t.field.attr("data-"+r.namespace+"-length-min");if(i==1)i=i+" caracter";else i=i+" caracteres";n=n.replace("{0}",i);break;case e.ambarFormsValidator.Validator.LENGTH_MAX:if(t.field.attr("data-"+r.namespace+"-length-max-error-message")!=undefined)n=t.field.attr("data-"+r.namespace+"-length-max-error-message");var i=t.field.attr("data-"+r.namespace+"-length-max");if(i==1)i=i+" caracter";else i=i+" caracteres";n=n.replace("{0}",i);break;case e.ambarFormsValidator.Validator.EQUAL_TO:if(t.field.attr("data-"+r.namespace+"-equal-to-error-message")!=undefined){n=t.field.attr("data-"+r.namespace+"-equal-to-error-message")}else{var s=t.field.attr("data-"+r.namespace+"-equal-to");n=n.replace("{0}",e('label[for="'+s+'"]').html());n=n.replace("{1}",e('label[for="'+t.field.attr("name")+'"]').html())}break;case e.ambarFormsValidator.Validator.REQUIRED:n=t.message;if(t.field.attr("data-"+r.namespace+"-required-error-message")!=undefined)n=t.field.attr("data-"+r.namespace+"-required-error-message");break;case e.ambarFormsValidator.Validator.FORMAT:n=t.message;if(t.field.attr("data-"+r.namespace+"-format-error-message")!=undefined)n=t.field.attr("data-"+r.namespace+"-format-error-message");break;case e.ambarFormsValidator.Validator.SELECT_DEFAULT:n=t.message;if(t.field.attr("data-"+r.namespace+"-default-error-message")!=undefined)n=t.field.attr("data-"+r.namespace+"-default-error-message");break}return n}var t;var n=null;var r={namespace:"afv",expresions:{email:/^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\.)+([A-Za-z0-9]{2,4}|museum)$/,url:/((http\:\/\/|https\:\/\/|ftp\:\/\/)|(www.))+(([a-zA-Z0-9\.-]+\.[a-zA-Z]{2,4})|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(\/[a-zA-Z0-9%:\/-_\?\.'~]*)?/,string:/^[a-zA-Z]+$/,number:/^\s*\d+\s*$/,extendedString:/^[-\sa-zA-Z0-9]+$/},errorMessages:{required:"El campo es obligatorio",minLength:"El campo debe tener {0} como mínimo",maxLength:"El campo debe tener {0} como máximo",defaultOption:"Debe seleccionar un valor",equalTo:"Los campos {0} y {1} deben ser iguales",format:"El valor ingresado no se corresponde con el formato requerido",minCheckbox:"Se deben seleccionar al menos {0}"},errorDisplay:"inside",errorDisplayId:"afv-error-viewer",errorDisplayTag:"div",errorClass:"afv-field-error"};e.fn.ambarFormsValidator=function(t){if(s[t]){return s[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return s.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.ambarFormsValidator")}};var s={init:function(t){e.extend(r,t);e(document).ready(function(){e("[data-"+r.namespace+"-validate=true]").each(function(t,n){var n=e(n);var i={form:n};n.find("[data-"+r.namespace+"-role=submit]").bind("click",i,s.submit)})})},validate:function(n){var i=true;t=[];e("."+r.errorClass).removeClass(r.errorClass).removeAttr("title");n.find("[data-"+r.namespace+"-required]").each(function(n,s){var s=e(s);var o=s.attr("type");if(o==undefined)o=s[0].type;switch(o){case"checkbox":if(!s.is(":checked")){i=false;t.push({field:s,message:r.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}break;case"fieldset":var u=s.find('input[type="radio"]');var a=false;if(u.length>0){u.each(function(t,n){var n=e(n);if(n.is(":checked")){a=true;return}});if(!a){i=false;t.push({field:s,message:r.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}}else{console.error("AFV: El elemento no contiene radio buttons en su interior",s)}break;default:if(s.val().length==0){i=false;t.push({field:s,message:r.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}}});n.find("[data-"+r.namespace+"-check]").each(function(n,s){var s=e(s);var o=s.attr("data-"+r.namespace+"-check");var u=s.find('input[type="checkbox"]:checked').length;if(u<o){i=false;t.push({field:s,message:r.errorMessages.minCheckbox,error:e.ambarFormsValidator.Validator.CHECKBOX_MIN})}});n.find("[data-"+r.namespace+"-length-min]").each(function(n,s){var s=e(s);var o=e(s).attr("data-"+r.namespace+"-length-min");if(s.val().length<o){i=false;t.push({field:s,message:r.errorMessages.minLength,error:e.ambarFormsValidator.Validator.LENGTH_MIN})}});n.find("[data-"+r.namespace+"-length-max]").each(function(n,s){var s=e(s);var o=e(s).attr("data-"+r.namespace+"-length-max");if(s.val().length>o){i=false;t.push({field:s,message:r.errorMessages.maxLength,error:e.ambarFormsValidator.Validator.LENGTH_MAX})}});n.find("[data-"+r.namespace+"-equal-to]").each(function(n,s){var s=e(s);var o=e(s).attr("data-"+r.namespace+"-equal-to");o=e("#"+o);if(s.val()!=o.val()){i=false;t.push({field:s,message:r.errorMessages.equalTo,error:e.ambarFormsValidator.Validator.EQUAL_TO})}});n.find("[data-"+r.namespace+"-default]").each(function(n,s){var s=e(s);var o=s.attr("data-"+r.namespace+"-default");if(s.val()==o){i=false;t.push({field:s,message:r.errorMessages.defaultOption,error:e.ambarFormsValidator.Validator.SELECT_DEFAULT})}});n.find("[data-"+r.namespace+"-format]").each(function(n,s){var s=e(s);var o=s.attr("data-"+r.namespace+"-format");var u=r.expresions[o];if(!u.test(s.val())){i=false;t.push({field:s,message:r.errorMessages.format,error:e.ambarFormsValidator.Validator.FORMAT})}});return i},submit:function(t){t.preventDefault();n=t.data.form;if(s.validate(n)==true){if(n.attr("data-"+r.namespace+"-post-ajax")){var i=n.attr("action");var o=n.attr("method");var u=n.attr("data-"+r.namespace+"-ajax-success");var a=n.attr("data-"+r.namespace+"-ajax-failure");if(typeof u=="string")u=self[u];if(typeof a=="string")a=self[a];e.ajax({url:i,type:o,data:n.serialize(),cache:false,dataType:"json",success:u,error:a})}else{n.submit()}}else{var f=r.errorDisplay;if(n.attr("data-"+r.namespace+"-error-display-position")!=undefined)f=n.attr("data-"+r.namespace+"-error-display-position");switch(f){case e.ambarFormsValidator.Display.INSIDE:s.display_inside();break;case e.ambarFormsValidator.Display.FIELDS_BEFORE:s.display_viewer(n,e.ambarFormsValidator.Display.FIELDS_BEFORE);break;case e.ambarFormsValidator.Display.FIELDS_AFTER:s.display_viewer(n,e.ambarFormsValidator.Display.FIELDS_AFTER);break}}},display_inside:function(){e(t).each(function(t,n){n.field.addClass(r.errorClass);switch(n.field.attr("type")){case"checkbox":var s=n.field.attr("name");s=e('label[for="'+s+'"]');s.addClass(r.errorClass);s.attr("title",o);break}var o=i(n);if(n.field.attr("title")==undefined)n.field.attr("title",o);else n.field.attr("title",n.field.attr("title")+"\n"+o)})},display_viewer:function(n,s){var o=n.find("#"+r.errorDisplayId);if(o.length==0){o=e("<"+r.errorDisplayTag+"></"+r.errorDisplayTag+">").attr("id",r.errorDisplayId);if(s==e.ambarFormsValidator.Display.FIELDS_BEFORE)o.prependTo(n);if(s==e.ambarFormsValidator.Display.FIELDS_AFTER)o.appendTo(n)}o.html("");var u=e("<ul></ul>");e(t).each(function(t,n){n.field.addClass(r.errorClass);var s=n.field.attr("name");s=e('label[for="'+s+'"]');switch(n.field.attr("type")){case"checkbox":s.addClass(r.errorClass);s.attr("title",o);break}var o="<em>"+s.html()+": </em>"+i(n);var a=e("<li></li>").html(o);u.append(a)});u.appendTo(o)}};e.ambarFormsValidator={Validator:{REQUIRED:"required",LENGTH_MIN:"minLength",LENGTH_MAX:"maxLength",EQUAL_TO:"equalTo",SELECT_DEFAULT:"default",FORMAT:"format",CHECKBOX_MIN:"minCheckbox"},Display:{INSIDE:"inside",FIELDS_BEFORE:"before",FIELDS_AFTER:"after"},version:"0.1.0"}})(jQuery);$(document).ambarFormsValidator()