/**
 * jQuery - Ambar Forms Validator
 *
 * @author Javier Trejo @ JT - Comunicación Interactiva
 * @version 0.2.4
 * @see http://jt-comunicacioninteractiva.github.com/jquery-afv
 *
 * Este plugin se utiliza para validar formularios antes de ser enviados al
 * servidor.
 * Se inicia a si mismo por lo que no es necesario invocarlo y se vale de
 * los atributos data-afv-* y los atributos estandar de HTML para la
 * configuración.
 *
 */
(function($){function errorMessageComposer(e){var t=defaultOptions.errorMessages[e.error];switch(e.error){case $.ambarFormsValidator.Validator.CHECKBOX_MIN:if(e.field.attr("data-"+defaultOptions.namespace+"-check-error-message")!=undefined){t=e.field.attr("data-"+defaultOptions.namespace+"-check-error-message")}else{var n=e.field.attr("data-"+defaultOptions.namespace+"-check");if(n==1)n=n+" opción";else n=n+" opciones";t=t.replace("{0}",n)}break;case $.ambarFormsValidator.Validator.LENGTH_MIN:if(e.field.attr("data-"+defaultOptions.namespace+"-length-min-error-message")!=undefined)t=e.field.attr("data-"+defaultOptions.namespace+"-length-min-error-message");var n=e.field.attr("data-"+defaultOptions.namespace+"-length-min");if(n==1)n=n+" caracter";else n=n+" caracteres";t=t.replace("{0}",n);break;case $.ambarFormsValidator.Validator.LENGTH_MAX:if(e.field.attr("data-"+defaultOptions.namespace+"-length-max-error-message")!=undefined)t=e.field.attr("data-"+defaultOptions.namespace+"-length-max-error-message");var n=e.field.attr("data-"+defaultOptions.namespace+"-length-max");if(n==1)n=n+" caracter";else n=n+" caracteres";t=t.replace("{0}",n);break;case $.ambarFormsValidator.Validator.EQUAL_TO:if(e.field.attr("data-"+defaultOptions.namespace+"-equal-to-error-message")!=undefined){t=e.field.attr("data-"+defaultOptions.namespace+"-equal-to-error-message")}else{var r=e.field.attr("data-"+defaultOptions.namespace+"-equal-to");t=t.replace("{0}",$('label[for="'+r+'"]').html());t=t.replace("{1}",$('label[for="'+e.field.attr("name")+'"]').html())}break;case $.ambarFormsValidator.Validator.REQUIRED:t=e.message;if(e.field.attr("data-"+defaultOptions.namespace+"-required-error-message")!=undefined)t=e.field.attr("data-"+defaultOptions.namespace+"-required-error-message");break;case $.ambarFormsValidator.Validator.FORMAT:t=e.message;if(e.field.attr("data-"+defaultOptions.namespace+"-format-error-message")!=undefined)t=e.field.attr("data-"+defaultOptions.namespace+"-format-error-message");break;case $.ambarFormsValidator.Validator.SELECT_DEFAULT:t=e.message;if(e.field.attr("data-"+defaultOptions.namespace+"-default-error-message")!=undefined)t=e.field.attr("data-"+defaultOptions.namespace+"-default-error-message");break}return t}function scriptPreSettings(){var scripts=$("script");var parameters=[];scripts.each(function(e,t){var n=t.src.match(/\w+=\w+/g);if(n!=null)$.merge(parameters,n)});var toExtend={};$(parameters).each(function(index,item){var exploded=item.split("=");toExtend[exploded[0]]=eval(exploded[1])});$.extend(initialSettings,toExtend)}function initFormActions(e){$(e).each(function(e,t){var t=$(t);var n={form:t};t.find("[data-"+defaultOptions.namespace+"-role=submit]").bind("click",n,methods.submit)})}var errorsCollection;var formToValidate=null;var defaultOptions={namespace:"afv",expresions:{email:/^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\.)+([A-Za-z0-9]{2,4}|museum)$/,url:/((http\:\/\/|https\:\/\/|ftp\:\/\/)|(www.))+(([a-zA-Z0-9\.-]+\.[a-zA-Z]{2,4})|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(\/[a-zA-Z0-9%:\/-_\?\.'~]*)?/,string:/^[a-zA-Z]+$/,number:/^\s*\d+\s*$/,extendedString:/^[-\sa-zA-Z0-9]+$/},errorMessages:{required:"El campo es obligatorio",minLength:"El campo debe tener {0} como mínimo",maxLength:"El campo debe tener {0} como máximo",defaultOption:"Debe seleccionar un valor",equalTo:"Los campos {0} y {1} deben ser iguales",format:"El valor ingresado no se corresponde con el formato requerido",minCheckbox:"Se deben seleccionar al menos {0}"},errorDisplay:"inside",errorDisplayId:"afv-error-viewer",errorDisplayTag:"div",errorClass:"afv-field-error"};var initialSettings={liveObserver:false};$.fn.ambarFormsValidator=function(e){if(methods[e]){return methods[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return methods.init.apply(this,arguments)}else{$.error("Method "+e+" does not exist on jQuery.ambarFormsValidator")}};var methods={init:function(e){scriptPreSettings();$.extend(defaultOptions,e);$(document).ready(function(){initFormActions("[data-"+defaultOptions.namespace+"-validate=true]");if(initialSettings.liveObserver){$(document).live("DOMSubtreeModified",function(e){var t=$(e.srcElement);if(t.find("form").length>0)initFormActions("[data-"+defaultOptions.namespace+"-validate=true]")})}})},validate:function(e){var t=true;errorsCollection=[];$("."+defaultOptions.errorClass).removeClass(defaultOptions.errorClass).removeAttr("title");e.find("[data-"+defaultOptions.namespace+"-required]").each(function(e,n){var n=$(n);var r=n.attr("type");if(r==undefined)r=n[0].type;switch(r){case"checkbox":if(!n.is(":checked")){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.required,error:$.ambarFormsValidator.Validator.REQUIRED})}break;case"fieldset":var i=n.find('input[type="radio"]');var s=false;if(i.length>0){i.each(function(e,t){var t=$(t);if(t.is(":checked")){s=true;return}});if(!s){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.required,error:$.ambarFormsValidator.Validator.REQUIRED})}}else{console.error("AFV: El elemento no contiene radio buttons en su interior",n)}break;default:if(n.val().length==0){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.required,error:$.ambarFormsValidator.Validator.REQUIRED})}}});e.find("[data-"+defaultOptions.namespace+"-check]").each(function(e,n){var n=$(n);var r=n.attr("data-"+defaultOptions.namespace+"-check");var i=n.find('input[type="checkbox"]:checked').length;if(i<r){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.minCheckbox,error:$.ambarFormsValidator.Validator.CHECKBOX_MIN})}});e.find("[data-"+defaultOptions.namespace+"-length-min]").each(function(e,n){var n=$(n);var r=$(n).attr("data-"+defaultOptions.namespace+"-length-min");if(n.val().length<r){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.minLength,error:$.ambarFormsValidator.Validator.LENGTH_MIN})}});e.find("[data-"+defaultOptions.namespace+"-length-max]").each(function(e,n){var n=$(n);var r=$(n).attr("data-"+defaultOptions.namespace+"-length-max");if(n.val().length>r){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.maxLength,error:$.ambarFormsValidator.Validator.LENGTH_MAX})}});e.find("[data-"+defaultOptions.namespace+"-equal-to]").each(function(e,n){var n=$(n);var r=$(n).attr("data-"+defaultOptions.namespace+"-equal-to");r=$("#"+r);if(n.val()!=r.val()){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.equalTo,error:$.ambarFormsValidator.Validator.EQUAL_TO})}});e.find("[data-"+defaultOptions.namespace+"-default]").each(function(e,n){var n=$(n);var r=n.attr("data-"+defaultOptions.namespace+"-default");if(n.val()==r){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.defaultOption,error:$.ambarFormsValidator.Validator.SELECT_DEFAULT})}});e.find("[data-"+defaultOptions.namespace+"-format]").each(function(e,n){var n=$(n);var r=n.attr("data-"+defaultOptions.namespace+"-format");var i=defaultOptions.expresions[r];if(!i.test(n.val())){t=false;errorsCollection.push({field:n,message:defaultOptions.errorMessages.format,error:$.ambarFormsValidator.Validator.FORMAT})}});return t},submit:function(e){e.preventDefault();formToValidate=e.data.form;if(methods.validate(formToValidate)==true){if(formToValidate.attr("data-"+defaultOptions.namespace+"-post-ajax")){var t=formToValidate.attr("action");var n=formToValidate.attr("method");var r=formToValidate.attr("data-"+defaultOptions.namespace+"-ajax-success");var i=formToValidate.attr("data-"+defaultOptions.namespace+"-ajax-failure");if(typeof r=="string")r=self[r];if(typeof i=="string")i=self[i];$.ajax({url:t,type:n,data:formToValidate.serialize(),cache:false,dataType:"json",success:r,error:i})}else{formToValidate.submit()}}else{var s=defaultOptions.errorDisplay;if(formToValidate.attr("data-"+defaultOptions.namespace+"-error-display-position")!=undefined)s=formToValidate.attr("data-"+defaultOptions.namespace+"-error-display-position");switch(s){case $.ambarFormsValidator.Display.INSIDE:methods.display_inside();break;case $.ambarFormsValidator.Display.FIELDS_BEFORE:methods.display_viewer(formToValidate,$.ambarFormsValidator.Display.FIELDS_BEFORE);break;case $.ambarFormsValidator.Display.FIELDS_AFTER:methods.display_viewer(formToValidate,$.ambarFormsValidator.Display.FIELDS_AFTER);break}}},display_inside:function(){$(errorsCollection).each(function(e,t){t.field.addClass(defaultOptions.errorClass);switch(t.field.attr("type")){case"checkbox":var n=t.field.attr("name");n=$('label[for="'+n+'"]');n.addClass(defaultOptions.errorClass);n.attr("title",r);break}var r=errorMessageComposer(t);if(t.field.attr("title")==undefined)t.field.attr("title",r);else t.field.attr("title",t.field.attr("title")+"\n"+r)})},display_viewer:function(e,t){var n=e.find("#"+defaultOptions.errorDisplayId);if(n.length==0){n=$("<"+defaultOptions.errorDisplayTag+"></"+defaultOptions.errorDisplayTag+">").attr("id",defaultOptions.errorDisplayId);if(t==$.ambarFormsValidator.Display.FIELDS_BEFORE)n.prependTo(e);if(t==$.ambarFormsValidator.Display.FIELDS_AFTER)n.appendTo(e)}n.html("");var r=$("<ul></ul>");$(errorsCollection).each(function(e,t){t.field.addClass(defaultOptions.errorClass);var n=t.field.attr("name");n=$('label[for="'+n+'"]');switch(t.field.attr("type")){case"checkbox":n.addClass(defaultOptions.errorClass);n.attr("title",i);break}var i="<em>"+n.html()+": </em>"+errorMessageComposer(t);var s=$("<li></li>").html(i);r.append(s)});$("<h2>Verifique los siguientes campos antes de continuar</h2>").appendTo(n);r.appendTo(n)}};$.ambarFormsValidator={Validator:{REQUIRED:"required",LENGTH_MIN:"minLength",LENGTH_MAX:"maxLength",EQUAL_TO:"equalTo",SELECT_DEFAULT:"default",FORMAT:"format",CHECKBOX_MIN:"minCheckbox"},Display:{INSIDE:"inside",FIELDS_BEFORE:"before",FIELDS_AFTER:"after"},version:"0.1.0"}})(jQuery);$(document).ambarFormsValidator()