/**
 * jQuery - Ambar Forms Validator
 *
 * @author Javier Trejo @ JT - Comunicación Interactiva
 * @version 0.2.2
 * @see http://jt-comunicacioninteractiva.github.com/jquery-afv
 *
 * Este plugin se utiliza para validar formularios antes de ser enviados al
 * servidor.
 * Se inicia a si mismo por lo que no es necesario invocarlo y se vale de
 * los atributos data-afv-* y los atributos estandar de HTML para la
 * configuración.
 *
 */
(function(e){function r(t){var r=n.errorMessages[t.error];switch(t.error){case e.ambarFormsValidator.Validator.CHECKBOX_MIN:if(t.field.attr("data-"+n.namespace+"-check-error-message")!=undefined){r=t.field.attr("data-"+n.namespace+"-check-error-message")}else{var i=t.field.attr("data-"+n.namespace+"-check");if(i==1)i=i+" opción";else i=i+" opciones";r=r.replace("{0}",i)}break;case e.ambarFormsValidator.Validator.LENGTH_MIN:if(t.field.attr("data-"+n.namespace+"-length-min-error-message")!=undefined)r=t.field.attr("data-"+n.namespace+"-length-min-error-message");var i=t.field.attr("data-"+n.namespace+"-length-min");if(i==1)i=i+" caracter";else i=i+" caracteres";r=r.replace("{0}",i);break;case e.ambarFormsValidator.Validator.LENGTH_MAX:if(t.field.attr("data-"+n.namespace+"-length-max-error-message")!=undefined)r=t.field.attr("data-"+n.namespace+"-length-max-error-message");var i=t.field.attr("data-"+n.namespace+"-length-max");if(i==1)i=i+" caracter";else i=i+" caracteres";r=r.replace("{0}",i);break;case e.ambarFormsValidator.Validator.EQUAL_TO:if(t.field.attr("data-"+n.namespace+"-equal-to-error-message")!=undefined){r=t.field.attr("data-"+n.namespace+"-equal-to-error-message")}else{var s=t.field.attr("data-"+n.namespace+"-equal-to");r=r.replace("{0}",e('label[for="'+s+'"]').html());r=r.replace("{1}",e('label[for="'+t.field.attr("name")+'"]').html())}break;case e.ambarFormsValidator.Validator.REQUIRED:r=t.message;if(t.field.attr("data-"+n.namespace+"-required-error-message")!=undefined)r=t.field.attr("data-"+n.namespace+"-required-error-message");break;case e.ambarFormsValidator.Validator.FORMAT:r=t.message;if(t.field.attr("data-"+n.namespace+"-format-error-message")!=undefined)r=t.field.attr("data-"+n.namespace+"-format-error-message");break;case e.ambarFormsValidator.Validator.SELECT_DEFAULT:r=t.message;if(t.field.attr("data-"+n.namespace+"-default-error-message")!=undefined)r=t.field.attr("data-"+n.namespace+"-default-error-message");break}return r}var t;var n={namespace:"afv",expresions:{email:/^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\.)+([A-Za-z0-9]{2,4}|museum)$/,url:/((http\:\/\/|https\:\/\/|ftp\:\/\/)|(www.))+(([a-zA-Z0-9\.-]+\.[a-zA-Z]{2,4})|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(\/[a-zA-Z0-9%:\/-_\?\.'~]*)?/,string:/^[a-zA-Z]+$/,number:/^\s*\d+\s*$/,extendedString:/^[-\sa-zA-Z0-9]+$/},errorMessages:{required:"El campo es obligatorio",minLength:"El campo debe tener {0} como mínimo",maxLength:"El campo debe tener {0} como máximo",defaultOption:"Debe seleccionar un valor",equalTo:"Los campos {0} y {1} deben ser iguales",format:"El valor ingresado no se corresponde con el formato requerido",minCheckbox:"Se deben seleccionar al menos {0}"},errorDisplay:"inside",errorClass:"afv-field-error"};var i={init:function(t){e.extend(n,t);e(document).ready(function(){e("[data-"+n.namespace+"-validate=true]").find("[data-"+n.namespace+"-role=submit]").bind("click",i.submit)})},validate:function(r){var i=true;t=[];e("."+n.errorClass).removeClass(n.errorClass).removeAttr("title");r.find("[data-"+n.namespace+"-required]").each(function(r,s){var s=e(s);var o=s.attr("type");if(o==undefined)o=s[0].type;switch(o){case"checkbox":if(!s.is(":checked")){i=false;t.push({field:s,message:n.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}break;case"fieldset":var u=s.find('input[type="radio"]');var a=false;if(u.length>0){u.each(function(t,n){var n=e(n);if(n.is(":checked")){a=true;return}});if(!a){i=false;t.push({field:s,message:n.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}}else{console.error("AFV: El elemento no contiene radio buttons en su interior",s)}break;default:if(s.val().length==0){i=false;t.push({field:s,message:n.errorMessages.required,error:e.ambarFormsValidator.Validator.REQUIRED})}}});r.find("[data-"+n.namespace+"-check]").each(function(r,s){var s=e(s);var o=s.attr("data-"+n.namespace+"-check");var u=s.find('input[type="checkbox"]:checked').length;if(u<o){i=false;t.push({field:s,message:n.errorMessages.minCheckbox,error:e.ambarFormsValidator.Validator.CHECKBOX_MIN})}});r.find("[data-"+n.namespace+"-length-min]").each(function(r,s){var s=e(s);var o=e(s).attr("data-"+n.namespace+"-length-min");if(s.val().length<o){i=false;t.push({field:s,message:n.errorMessages.minLength,error:e.ambarFormsValidator.Validator.LENGTH_MIN})}});r.find("[data-"+n.namespace+"-length-max]").each(function(r,s){var s=e(s);var o=e(s).attr("data-"+n.namespace+"-length-max");if(s.val().length>o){i=false;t.push({field:s,message:n.errorMessages.maxLength,error:e.ambarFormsValidator.Validator.LENGTH_MAX})}});r.find("[data-"+n.namespace+"-equal-to]").each(function(r,s){var s=e(s);var o=e(s).attr("data-"+n.namespace+"-equal-to");o=e("#"+o);if(s.val()!=o.val()){i=false;t.push({field:s,message:n.errorMessages.equalTo,error:e.ambarFormsValidator.Validator.EQUAL_TO})}});r.find("[data-"+n.namespace+"-default]").each(function(r,s){var s=e(s);var o=s.attr("data-"+n.namespace+"-default");if(s.val()==o){i=false;t.push({field:s,message:n.errorMessages.defaultOption,error:e.ambarFormsValidator.Validator.SELECT_DEFAULT})}});r.find("[data-"+n.namespace+"-format]").each(function(r,s){var s=e(s);var o=s.attr("data-"+n.namespace+"-format");var u=n.expresions[o];if(!u.test(s.val())){i=false;t.push({field:s,message:n.errorMessages.format,error:e.ambarFormsValidator.Validator.FORMAT})}});return i},submit:function(t){t.preventDefault();var r=e(this).parent();if(i.validate(r)==true){if(r.attr("data-"+n.namespace+"-post-ajax")){var s=r.attr("action");var o=r.attr("method");var u=r.attr("data-"+n.namespace+"-ajax-success");var a=r.attr("data-"+n.namespace+"-ajax-failure");if(typeof u=="string")u=self[u];if(typeof a=="string")a=self[a];e.ajax({url:s,type:o,data:r.serialize(),cache:false,dataType:"json",success:u,error:a})}else{r.submit()}}else{switch(n.errorDisplay){case e.ambarFormsValidator.Display.INSIDE:i.display_inside();break;case e.ambarFormsValidator.Display.OUTSIDE:i.display_outside();break;case e.ambarFormsValidator.Display.FIELDS_BEFORE:i.display_before();break;case e.ambarFormsValidator.Display.FIELDS_AFTER:i.display_after();break}}},display_inside:function(){e(t).each(function(t,i){i.field.addClass(n.errorClass);switch(i.field.attr("type")){case"checkbox":var s=i.field.attr("name");s=e('label[for="'+s+'"]');s.addClass(n.errorClass);s.attr("title",o);break}var o=r(i);if(i.field.attr("title")==undefined)i.field.attr("title",o);else i.field.attr("title",i.field.attr("title")+"\n"+o)})},display_outside:function(){console.log("V0.2 - Muestra los mensajes de error fuera del campo a través de un elemento span")},fields_before:function(){console.log("V0.3 - Muestra los mensajes de error todos juntos al principio del formulario en un elemento div")},fields_after:function(){console.log("V0.3 - Muestra los mensajes de error todos juntos al final del formulario en un elemento div")}};e.fn.ambarFormsValidator=function(t){if(i[t]){return i[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return i.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.ambarFormsValidator")}};e.ambarFormsValidator={Validator:{REQUIRED:"required",LENGTH_MIN:"minLength",LENGTH_MAX:"maxLength",EQUAL_TO:"equalTo",SELECT_DEFAULT:"default",FORMAT:"format",CHECKBOX_MIN:"minCheckbox"},Display:{INSIDE:"inside",OUTSIDE:"outside",FIELDS_BEFORE:"before",FIELDS_AFTER:"after"},version:"0.1.0"}})(jQuery);$(document).ambarFormsValidator()